<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">lib/index.js | @ericblade/mws-advanced</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="Modern, fully featured, very opinionated node javascript Amazon MWS API based on @ericblade/mws-simple"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="@ericblade/mws-advanced"><meta property="twitter:description" content="Modern, fully featured, very opinionated node javascript Amazon MWS API based on @ericblade/mws-simple"></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/errors.js~InvalidIdentifier.html">InvalidIdentifier</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/errors.js~InvalidUsage.html">InvalidUsage</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/errors.js~RequestCancelled.html">RequestCancelled</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/errors.js~ServiceError.html">ServiceError</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/errors.js~ValidationError.html">ValidationError</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/index.js~MwsAdvanced.html">MwsAdvanced</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-MARKET_CURRENCY">MARKET_CURRENCY</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-MWS_ENDPOINTS">MWS_ENDPOINTS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-MWS_MARKETPLACES">MWS_MARKETPLACES</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#endpoints">endpoints</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/endpoints/Queue.js~Queue.html">Queue</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getQueue">getQueue</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-registerQueue">registerQueue</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-REPORT_PROCESSING_STATUS_TYPES">REPORT_PROCESSING_STATUS_TYPES</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-REQUEST_REPORT_TYPES">REQUEST_REPORT_TYPES</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#helpers">helpers</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getInboundGuidanceForASIN">getInboundGuidanceForASIN</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getInboundGuidanceForSKU">getInboundGuidanceForSKU</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getLowestPricedOffersForASIN">getLowestPricedOffersForASIN</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getLowestPricedOffersForSKU">getLowestPricedOffersForSKU</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getMatchingProductForId">getMatchingProductForId</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getMyFeesEstimate">getMyFeesEstimate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getOrder">getOrder</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getProductCategoriesForSkus">getProductCategoriesForSkus</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-listFinancialEvents">listFinancialEvents</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-listInventorySupply">listInventorySupply</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-listMatchingProducts">listMatchingProducts</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-listOrders">listOrders</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getReport">getReport</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getReportList">getReportList</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getReportListAll">getReportListAll</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getReportListByNextToken">getReportListByNextToken</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getReportRequestList">getReportRequestList</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getReportScheduleList">getReportScheduleList</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-manageReportSchedule">manageReportSchedule</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-requestAndDownloadReport">requestAndDownloadReport</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-updateReportAcknowledgements">updateReportAcknowledgements</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-MarketDetail">MarketDetail</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-Estimate">Estimate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-EstimateRequest">EstimateRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-FeeDetail">FeeDetail</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-FeeIdentifier">FeeIdentifier</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-productCategory">productCategory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-productCategoryByAsin">productCategoryByAsin</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-productCategoryBySku">productCategoryBySku</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-OrderItemList">OrderItemList</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-GetReportRequestListResult">GetReportRequestListResult</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-ReportRequestInfo">ReportRequestInfo</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#parsers">parsers</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-parseFeesEstimate">parseFeesEstimate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-parseAnyInboundGuidance">parseAnyInboundGuidance</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-parseMarketplaceData">parseMarketplaceData</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-parseMatchingProduct">parseMatchingProduct</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-MWSASINInboundGuidance">MWSASINInboundGuidance</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-MWSASINInboundGuidanceList">MWSASINInboundGuidanceList</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-MWSGuidanceReasonList">MWSGuidanceReasonList</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-MWSInboundGuidance">MWSInboundGuidance</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-MWSInvalidASIN">MWSInvalidASIN</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-MWSInvalidASINList">MWSInvalidASINList</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-MWSInvalidSKU">MWSInvalidSKU</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-MWSInvalidSKUList">MWSInvalidSKUList</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-MWSSKUInboundGuidance">MWSSKUInboundGuidance</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-MWSSKUInboundGuidanceList">MWSSKUInboundGuidanceList</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-guidanceReason">guidanceReason</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-inboundGuidance">inboundGuidance</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-invalidAsin">invalidAsin</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-invalidSku">invalidSku</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-BuyBoxPrice">BuyBoxPrice</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-DetailedShippingTime">DetailedShippingTime</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-LowestPrice">LowestPrice</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-LowestPricedOffers">LowestPricedOffers</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-Money">Money</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-Offer">Offer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-OfferCount">OfferCount</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-OfferSummary">OfferSummary</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-SellerFeedbackRating">SellerFeedbackRating</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-ShipsFrom">ShipsFrom</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-ProductIdentifier">ProductIdentifier</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-OrderItem">OrderItem</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-OrderItemsList">OrderItemsList</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-orderItemsList">orderItemsList</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">lib/index.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">const fs = require(&apos;fs&apos;);
const path = require(&apos;path&apos;);

const MWS = require(&apos;@ericblade/mws-simple&apos;);
const Queues = require(&apos;./endpoints/Queue&apos;);

const errors = require(&apos;./errors&apos;);
const constants = require(&apos;./constants&apos;);

const { flattenResult } = require(&apos;./util/flatten-result&apos;);
const { validateAndTransformParameters } = require(&apos;./util/validation&apos;);
const { digResponseResult } = require(&apos;./util/dig-response-result.js&apos;);

// esdoc doesn&apos;t handle this line when destructuring for some reason.
const MWS_ENDPOINTS = constants.MWS_ENDPOINTS; // eslint-disable-line prefer-destructuring

// TODO: add Subscriptions and Recommendations categories
const {
    feeds, finances, inbound, inventory, outbound,
    merchFulfillment, orders, products, sellers, reports,
    recommendations,
} = require(&apos;./endpoints&apos;);

// TODO: THIS MAY BE A BAD IDEA CONSIDERING THAT SOME CATEGORIES SHARE SOME ENDPOINT NAMES
// TODO: WE MAY NEED TO COME UP WITH A WAY TO DEAL WITH THAT.

/** simple flat list of all the endpoints required from individual modules above */
const endpoints = {
    ...feeds,
    ...finances,
    ...inbound,
    ...inventory,
    ...merchFulfillment,
    ...orders,
    ...outbound,
    ...products,
    ...sellers,
    ...reports,
    ...recommendations,
};

/*
 * holds a reference to a MwsAdvanced if you call static init for old-style use,
 * to prevent garbage collection
 */
let staticMws = null;

class MwsAdvanced {
    /**
     * Create a new instance of MWSAdvanced, calling init(), and binding this instance of callEndpoint
     * to this instance of MWSAdvanced.
     *
     * @param {object} rest - passed on to @see {@link #init}
     * @returns {MWSAdvanced} - new instance of MWSAdvanced
     */
    constructor(...args) {
        this.init(...args);
        this.callEndpoint = this.callEndpoint.bind(this);

        // argh, binding of functions.
        this.init = this.init.bind(this);
        this.doRequest = this.doRequest.bind(this);
        this.parseEndpoint = this.parseEndpoint.bind(this);
        this.callEndpoint = this.callEndpoint.bind(this);
        this.getInboundGuidanceForASIN = this.getInboundGuidanceForASIN.bind(this);
        this.getInboundGuidanceForSKU = this.getInboundGuidanceForSKU.bind(this);
        this.getMarketplaces = this.getMarketplaces.bind(this);
        this.listOrders = this.listOrders.bind(this);
        this.listOrderItems = this.listOrderItems.bind(this);
        this.getOrder = this.getOrder.bind(this);
        this.listFinancialEvents = this.listFinancialEvents.bind(this);
        this.listInventorySupply = this.listInventorySupply.bind(this);
        this.listMatchingProducts = this.listMatchingProducts.bind(this);
        this.getMatchingProductForId = this.getMatchingProductForId.bind(this);
        this.getLowestPricedOffersForAsin = this.getLowestPricedOffersForAsin.bind(this);
        this.getLowestPricedOffersForSku = this.getLowestPricedOffersForSku.bind(this);
        this.getProductCategoriesForAsins = this.getProductCategoriesForAsins.bind(this);
        this.getProductCategoriesForSkus = this.getProductCategoriesForSkus.bind(this);
        this.getMyFeesEstimate = this.getMyFeesEstimate.bind(this);
        this.requestReport = this.requestReport.bind(this);
        this.getReportRequestList = this.getReportRequestList.bind(this);
        this.getReport = this.getReport.bind(this);
        this.getReportList = this.getReportList.bind(this);
        this.getReportListByNextToken = this.getReportListByNextToken.bind(this);
        this.getReportListAll = this.getReportListAll.bind(this);
        this.requestAndDownloadReport = this.requestAndDownloadReport.bind(this);
        this.manageReportSchedule = this.manageReportSchedule.bind(this);
        this.updateReportAcknowledgements = this.updateReportAcknowledgements.bind(this);
        this.getReportScheduleList = this.getReportScheduleList.bind(this);
        return this;
    }

    static init(...args) {
        staticMws = new MwsAdvanced(...args);
        return staticMws.init(...args);
    }

    /**
     * Initialize mws-advanced with your MWS access keys, merchantId, optionally authtoken, host, port
     * If accessKeyId, secretAccessKey, and/or merchantId are not provided, they will be read from
     * the environment variables MWS_ACESS_KEY, MWS_SECRET_ACCESS_KEY, and MWS_MERCHANT_ID respectively
     *
     * @public
     * @example
     * const mws = MWS.init({ region: &apos;NA&apos;, accessKeyId: &apos;1234&apos;, secretAccessKey: &apos;2345&apos;, merchantId: &apos;1234567890&apos; });
     * const mws = MWS.init({ region: &apos;EU&apos;, accessKeyId, ... });
     * const mws = MWS.init({ authToken: &apos;qwerty&apos;, accessKeyId, ...});
     * const mws = MWS.init({ host: &apos;alternate-mws-server.com&apos;, accessKeyId, ... });
     * @param {object} config Contains your MWS Access Keys/Tokens and options to configure the API
     * @param {string} [config.accessKeyId=process.env.MWS_ACCESS_KEY] Your MWS Access Key
     * @param {string} [config.secretAccessKey=process.env.MWS_SECRET_ACCESS_KEY] Your MWS Secret Access Key
     * @param {string} [config.merchantId=process.env.MWS_MERCHANT_ID] Your MWS Merchant ID
     * @param {string} [config.authToken] If making a call for a third party account, the Auth Token provided
     *                           for the third party account
     * @param {string} [config.region=&apos;NA&apos;] One of the Amazon regions as specified in https://docs.developer.amazonservices.com/en_US/dev_guide/DG_Endpoints.html
     * @param {string} [config.host=&apos;mws.amazonservices.com&apos;] Set MWS host server name, see https://docs.developer.amazonservices.com/en_US/dev_guide/DG_Endpoints.html
     * @param {number} [config.port=443] Set MWS host port
     * @returns {mws-simple} - The mws-simple instance used to communicate with the API
     */
    init({
        region = &apos;NA&apos;,
        accessKeyId = process.env.MWS_ACCESS_KEY,
        secretAccessKey = process.env.MWS_SECRET_ACCESS_KEY,
        merchantId = process.env.MWS_MERCHANT_ID,
        authToken,
        host = MWS_ENDPOINTS[region] || &apos;mws.amazonservices.com&apos;,
        port,
    } = {}) {
        this.mws = new MWS({
            accessKeyId,
            secretAccessKey,
            merchantId,
            authToken,
            host,
            port,
        });
        return this.mws;
    }

    async doRequest(requestData, options = {}) {
        try {
            const { result, headers } = await this.mws.request(requestData);
            const ret = options.noFlatten ? result : flattenResult(result);
            ret.headers = headers;
            return ret;
        } catch (err) {
            throw err;
        }
    }

    parseEndpoint(outParser, inParser = x =&gt; x) {
        return mwsApiName =&gt; async (callOptions, opt) =&gt; outParser(await this.callEndpoint(mwsApiName, inParser(callOptions), opt));
    }

    static parseEndpoint(...args) {
        return staticMws.parseEndpoint(...args);
    }

    static async callEndpoint(...args) {
        // TODO: throw error if init() not called yet
        return staticMws.callEndpoint(...args);
    }

    /**
     * Call a known endpoint at MWS, returning the raw data from the function. Parameters are
     * transformed and validated according to the rules defined in lib/endpoints
     *
     * @async
     * @public
     * @param {string} name - name of MWS API function to call
     * @param {object} [callOptions] - named hash object of the parameters to pass to the API
     * @param {string} [callOptions.feedContent] - if calling a function that submits a feed, supply the feed data here
     * @param {any} [callOptions....rest] - other parameters will be passed through validation and into the API
     * @param {object} [opt] - options for callEndpoint
     * @param {boolean} [opt.noFlatten] - do not flatten results
     * @param {boolean} [opt.returnRaw] - return only the raw data (may or may not be flattened)
     * @param {string} [opt.saveRaw] - filename to save raw data to (may or may not be flattened)
     * @param {string} [opt.saveParsed] - filename to save final parsed data to (not compatible with returnRaw, since parsing won&apos;t happen)
     * @param {int} [opt.maxThrottleRetries=2] - maximum number of retries for throttling
     * @returns {any} - Results of the call to MWS
     */
    async callEndpoint(name, callOptions = {}, opt = { maxThrottleRetries: 2 }) {
        const endpoint = endpoints[name];
        if (!endpoint) {
            throw new errors.InvalidUsage(`Unknown endpoint name supplied to callEndpoint, ${name}`);
        }

        const newOptions = endpoint.params
            ? validateAndTransformParameters(endpoint.params, callOptions)
            : callOptions;

        const { feedContent } = newOptions;
        delete newOptions.feedContent;

        const queryOptions = {
            ...newOptions,
            Action: endpoint.action,
            Version: endpoint.version,
        };

        const params = {
            path: `/${endpoint.category}/${endpoint.version}`,
            query: queryOptions,
            feedContent,
        };

        let q = Queues.getQueue(endpoint.category, endpoint.action, this.mws.merchantId);
        if (!q) {
            q = new Queues.Queue({
                api: this,
                category: endpoint.category,
                action: endpoint.action,
                maxInFlight: (endpoint.throttle &amp;&amp; endpoint.throttle.maxInFlight) || 0,
                restoreRate: (endpoint.throttle &amp;&amp; endpoint.throttle.restoreRate) || 0,
            });
            Queues.registerQueue(q, endpoint.category, endpoint.action, this.mws.merchantId);
        }
        // TODO: reduce the size of this try!
        try {
            const result = await q.request(params, { noFlatten: opt.noFlatten });
            if (opt.saveRaw) {
                fs.writeFileSync(path.join(process.cwd(), opt.saveRaw), JSON.stringify(result));
            }
            if (opt.returnRaw) {
                return result;
            }
            const digResult = digResponseResult(name, result);
            if (opt.saveParsed) {
                fs.writeFileSync(path.join(process.cwd(), opt.saveParsed), JSON.stringify(digResult));
            }
            return digResult;
        } catch (error) {
            throw error;
        }
    }

    /* eslint-disable global-require */

    // TODO: fill in documentation for getInboundGuidance*
    /**
     * Call MWS GetInboundGuidanceForASIN, return parsed results
     * @example
     */
    getInboundGuidanceForASIN(...params) {
        const { getInboundGuidanceForASIN } = require(&apos;./helpers/getInboundGuidance&apos;);
        return getInboundGuidanceForASIN(this)(...params);
    }

    static getInboundGuidanceForASIN(...params) {
        return staticMws.getInboundGuidanceForASIN(...params);
    }

    getInboundGuidanceForSKU(...params) {
        const { getInboundGuidanceForSKU } = require(&apos;./helpers/getInboundGuidance&apos;);
        return getInboundGuidanceForSKU(this)(...params);
    }

    static getInboundGuidanceForSKU(...params) {
        return staticMws.getInboundGuidanceForSKU(...params);
    }

    /**
     * Call MWS ListMarketplaceParticipations, return parsed results
     * @example
     * const marketplaces = (async () =&gt; await mws.getMarketplaces())();
     * (async function() {
     *    const result = await mws.getMarketplaces();
     *    console.log(result);
     * })();
     * @return {MarketDetail}
     */

    getMarketplaces(...params) {
        const helper = require(&apos;./helpers/getMarketplaces&apos;);
        return helper(this)(...params);
    }

    static getMarketplaces(...params) {
        return staticMws.getMarketplaces(...params);
    }

    /**
     * Return orders created or updated during a specific time frame
     * see https://docs.developer.amazonservices.com/en_UK/orders-2013-09-01/Orders_ListOrders.html
     * At least ONE of the search options (and maybe more depending on which ones you select) must be
     * specified. Error messages may or may not return information on what parameters you are missing.
     * If you are having trouble, see the official parameter documentation above.
     *
     * @param {object} options
     * @param {string[]} options.MarketplaceId Array of Marketplace IDs to search @see {@link MWS_MARKETPLACES}
     * @param {Date} [options.CreatedAfter] Select orders created at or after the given Date
     * @param {Date} [options.CreatedBefore] Select orders created at or before the given Date
     * @param {Date} [options.LastUpdatedAfter] Select orders updated at or after the given Date
     * @param {Date} [options.LastUpdatedBefore] Select orders updated at or before the given Date
     * @param {string} [options.OrderStatus] OrderStatus, see MWS doc page
     * @param {string} [options.FulfillmentChannel] AFN for Amazon fulfillment, MFN for merchant
     * @param {string} [options.PaymentMethod] All, COD, CVS, Other
     * @param {string} [options.BuyerEmail] Search for orders with given Email address
     * @param {string} [options.SellerOrderId] Specified seller order ID
     * @param {string} [options.MaxResultsPerPage=100] Max number of results to return, 1 &lt;=&gt; 100
     * @param {string} [options.TFMShipmentStatus] See MWS doc page
     * @returns {object}
     */
    listOrders(...params) {
        const helper = require(&apos;./helpers/listOrders&apos;);
        return helper(this)(...params);
    }

    static listOrders(...params) { return staticMws.listOrders(...params); }

    /**
     * Returns order items based on the AmazonOrderId that you specify.
     *
     * If you&apos;ve pulled a list of orders using @see {@link ListOrders}, or have order identifiers
     * stored in some other fashion, then to find out what items are actually on the orders, you will
     * need to call ListOrderItems to obtain details about the items that were ordered.  The ListOrders
     * call does not give you any information about the items, except how many of them have shipped or
     * not shipped.
     *
     * If an Order is in the Pending state, ListOrderItems will not return any pricing or promotion
     * information. Once an order has left the Pending state, the following items will be returned:
     *
     * ItemTax, GiftWrapPrice, ItemPrice, PromotionDiscount, GiftWrapTax, ShippingTax, ShippingPrice,
     * ShippingDiscount
     *
     * @public
     * @param {string} AmazonOrderId - 3-7-7 Amazon Order ID formatted string
     * @returns {OrderItemList}
     */
    listOrderItems(...params) {
        const helper = require(&apos;./helpers/listOrderItems&apos;);
        return helper(this)(...params);
    }

    static listOrderItems(...params) { return staticMws.listOrderItems(...params); }

    /**
     * Return orders by ID, i.e. Amazon Order ID.
     * see https://docs.developer.amazonservices.com/en_UK/orders-2013-09-01/Orders_GetOrder.html
     *
     * @param {object} options
     * @param {string[]} options A list of AmazonOrderId values. An AmazonOrderId is an Amazon-defined order identifier, in 3-7-7 format.
     * @returns {object} A list of orders
     */
    getOrder(...params) {
        const helper = require(&apos;./helpers/getOrder&apos;);
        return helper(this)(...params);
    }

    static getOrder(...params) { return staticMws.getOrder(...params); }

    /**
     * https://docs.developer.amazonservices.com/en_UK/finances/Finances_ListFinancialEvents.html
     *
     * @param {object} options
     * @param {number} options.maxResultsPerPage Maximum number of results to return (1 &lt;=&gt; 100)
     * @param {string} options.amazonOrderId An order number to search for
     * @param {string} options.financialEventGroupId Type of Financial Event to search for
     * @param {Date} options.postedAfter When to search for events after
     * @param {Date} options.postedBefore When to search for events prior to
     * @returns {object}
     */
    listFinancialEvents(...params) {
        const helper = require(&apos;./helpers/listFinancialEvents&apos;);
        return helper(this)(...params);
    }

    static listFinancialEvents(...params) { return staticMws.listFinancialEvents(...params); }

    /**
     * Return information about the availability of a seller&apos;s FBA inventory
     *
     * @param {object} options
     * @param {String[]} options.sellerSkus A list of SKUs for items to get inventory info for
     * @param {Date} options.queryStartDateTime Date to begin searching at
     * @param {string} options.responseGroup &apos;Basic&apos; = Do not include SupplyDetail, &apos;Detailed&apos; = Do
     * @param {string} options.marketplaceId Marketplace ID to search
     *
     * @returns {{ nextToken: string, supplyList: object[] }}
     */
    listInventorySupply(...params) {
        const helper = require(&apos;./helpers/listInventorySupply&apos;);
        return helper(this)(...params);
    }

    static listInventorySupply(...params) { return staticMws.listInventorySupply(...params); }

    /**
     * Return a list of products and their attributes, based on a text query and contextId.
     *
     * @param {object} options
     * @param {string} options.marketplaceId - marketplace identifier to search
     * @param {string} options.query - a search string &quot;with the same support as that provided on Amazon marketplace websites&quot;
     * @param {string} [options.queryContextId] - context in which to limit search. Not specified will mean &quot;search everywhere&quot;. See https://docs.developer.amazonservices.com/en_UK/products/Products_QueryContextIDs.html
     * @returns {Product[]} - Array of product information
     */
    listMatchingProducts(...params) {
        const helper = require(&apos;./helpers/listMatchingProducts&apos;);
        return helper(this)(...params);
    }

    static listMatchingProducts(...params) { return staticMws.listMatchingProducts(...params); }

    /**
     * Returns a list of products and their attributes, based on a list of ASIN, GCID, SellerSKU, UPC,
     * EAN, ISBN, or JAN values
     *
     * @param {Object} options see https://docs.developer.amazonservices.com/en_UK/products/Products_GetMatchingProductForId.html
     * @param {string} options.marketplaceId Identifier for marketplace (see getMarketplaces)
     * @param {string} options.idType Type of lookup to perform: ASIN, GCID, SellerSKU, UPC, EAN, ISBN, JAN
     * @param {string[]} options.idList List of codes to perform lookup on
     * @public
     * @returns {Product[]}
     */
    getMatchingProductForId(...params) {
        const helper = require(&apos;./helpers/getMatchingProduct&apos;);
        return helper(this)(...params);
    }

    static getMatchingProductForId(...params) { return staticMws.getMatchingProductForId(...params); }

    /**
     * getLowestPricedOffersForASIN
     *
     * Calls GetLowestPricedOffersForASIN, reformats results, and returns the data
     *
     * @param {object} options see https://docs.developer.amazonservices.com/en_UK/products/Products_GetLowestPricedOffersForASIN.html
     * @param {string} options.MarketplaceId Marketplace ID to search
     * @param {string} options.ASIN ASIN to search for
     * @param {string} options.ItemCondition Listing Condition: New, Used, Collectible, Refurbished, Club
     *
     * @return {LowestPricedOffers}
     */
    getLowestPricedOffersForAsin(...params) {
        const { getLowestPricedOffersForASIN } = require(&apos;./helpers/getLowestPricedOffers&apos;);
        return getLowestPricedOffersForASIN(this)(...params);
    }

    static getLowestPricedOffersForAsin(...params) {
        return staticMws.getLowestPricedOffersForAsin(...params);
    }

    /**
     * getLowestPricedOffersForSKU
     *
     * Calls GetLowestPricedOffersForSKU, reformats results, and returns the data
     *
     * @param {object} options see https://docs.developer.amazonservices.com/en_UK/products/Products_GetLowestPricedOffersForASIN.html
     * @param {string} options.MarketplaceId Marketplace ID to search
     * @param {string} options.SellerSKU SKU to search for
     * @param {string} options.ItemCondition Listing Condition: New, Used, Collectible, Refurbished, Club
     *
     * @return {LowestPricedOffers}
     */
    getLowestPricedOffersForSku(...params) {
        const { getLowestPricedOffersForSKU } = require(&apos;./helpers/getLowestPricedOffers&apos;);
        return getLowestPricedOffersForSKU(this)(...params);
    }

    static getLowestPricedOffersForSku(...params) {
        return staticMws.getLowestPricedOffersForSKU(...params);
    }

    /**
     * return product categories for multiple asins
     *
     * @param {object} parameters
     * @param {string} parameters.marketplaceId - marketplace identifier to run query on
     * @param {string[]} parameters.asins - Array of string ASINs to query for
     * @returns {productCategoryByAsin[]} - Array of product category information
     */
    getProductCategoriesForAsins(...params) {
        const { getProductCategoriesForAsins } = require(&apos;./helpers/getProductCategories&apos;);
        return getProductCategoriesForAsins(this)(...params);
    }

    static getProductCategoriesForAsins(...params) {
        return staticMws.getProductCategoriesForAsins(...params);
    }

    /**
     * return product categories for multiple SKUs
     *
     * @param {object} parameters
     * @param {string} parameters.marketplaceId - marketplace identifier to run query on
     * @param {string[]} parameters.skus - Array of string SKUs to query for
     * @returns {productCategoryBySku[]} - Array of product category information
     */
    getProductCategoriesForSkus(...params) {
        const { getProductCategoriesForSkus } = require(&apos;./helpers/getProductCategories&apos;);
        return getProductCategoriesForSkus(this)(...params);
    }

    static getProductCategoriesForSkus(...params) {
        return staticMws.getProductCategoriesForSkus(...params);
    }

    /**
     * Get an estimate of fees for an item, based on listing and shipping prices.
     *
     * @param {EstimateRequest[]} - Array of EstimateRequest items to get fees for
     * @returns {Object} - Object of Estimate items, indexed by EstimateRequest Identifier
     */
    getMyFeesEstimate(...params) {
        const helper = require(&apos;./helpers/getMyFeesEstimate&apos;);
        return helper(this)(...params);
    }

    static getMyFeesEstimate(...params) { return staticMws.getMyFeesEstimate(...params); }

    /**
     * Request a report from MWS
     * Many optional parameters may be required by MWS! Read [ReportType](https://docs.developer.amazonservices.com/en_US/reports/Reports_ReportType.html) for specifics!
     *
     * @async
     * @param {object} options
     * @param {string} options.ReportType Type of Report to Request @see {@link REQUEST_REPORT_TYPES}
     * @param {Date} [options.StartDate] Date to start report
     * @param {Date} [options.EndDate] Date to end report at
     * @param {object} [options.ReportOptions] Reports may have additional options available. Please see the [ReportType](https://docs.developer.amazonservices.com/en_US/reports/Reports_ReportType.html) official docs
     * @param {string[]} [MarketplaceId] Array of marketplace IDs to generate reports covering
     * @returns {ReportRequestInfo}
     */
    requestReport(...params) {
        const { requestReport: helper } = require(&apos;./helpers/reports&apos;);
        return helper(this)(...params);
    }

    static requestReport(...params) { return staticMws.requestReport(...params); }

    /**
     * Returns a list of report requests that you can use to get the ReportRequestId for a report
     * After calling requestReport, you should call this function occasionally to see if/when the report
     * has been processed.
     *
     * @async
     * @param {object} [options] Options to pass to GetReportRequestList
     * @param {string[]} [ReportRequestIdList] List of report request IDs @see {@link requestReport}
     * @param {string[]} [ReportTypeList] List of Report Types @see {@link REQUEST_REPORT_TYPES}
     * @param {string[]} [ReportProcessingStatusList] List of Report Processing
     * Status @see {@link REPORT_PROCESSING_STATUS_TYPES}
     * @param {number} [MaxCount=10] Maximum number of report requests to return, max is 100
     * @param {Date} [RequestedFromDate=90-days-past] Oldest date to search for
     * @param {Date} [RequestedToDate=Now] Newest date to search for
     * @returns {GetReportRequestListResult[]}
     */
    getReportRequestList(...params) {
        const { getReportRequestList: helper } = require(&apos;./helpers/reports&apos;);
        return helper(this)(...params);
    }

    static getReportRequestList(...params) { return staticMws.getReportRequestList(...params); }

    /**
     * Download a specific report identified by the ReportId and return it
     *
     * @async
     * @function getReport
     * @example mws.getReport({ ReportId: &apos;12660293969017879&apos; });
     *
     * @param {object} options - GetReport options, should contain a [ReportId]
     * @param {string} options.ReportId - Report number from [GetReportList] or [GeneratedReportId] from [GetReportRequestListResult]
     * @returns {(Array|object)} - Contents of the report to return (format may vary WIDELY between different reports generated, see [ReportType](https://docs.developer.amazonservices.com/en_US/reports/Reports_ReportType.html))
     */
    getReport(options) {
        const { getReport: helper } = require(&apos;./helpers/reports&apos;);
        return helper(this)(options);
    }

    static getReport(...params) { return staticMws.getReport(...params); }

    /**
     * TODO: write documentation for getReportList
    */
    getReportList(...params) {
        const { getReportList: helper } = require(&apos;./helpers/reports&apos;);
        return helper(this)(...params);
    }

    static getReportList(...params) { return staticMws.getReportList(...params); }

    /**
     * TODO: write documentation for getReportListByNextToken
     * (or just roll getReportList and getReportListByNextToken into the same wrapper)
     * (that wrapper might be getReportListAll, and just rename it)
     */
    getReportListByNextToken(...params) {
        const { getReportListByNextToken: helper } = require(&apos;./helpers/reports&apos;);
        return helper(this)(...params);
    }

    static getReportListByNextToken(...params) {
        return staticMws.getReportListByNextToken(...params);
    }

    /**
     * TODO: write documentation for getReportListAll (or see comment on getReportListByNextToken)
    */
    getReportListAll(...params) {
        const { getReportListAll: helper } = require(&apos;./helpers/reports&apos;);
        return helper(this)(...params);
    }

    static getReportListAll(...params) { return staticMws.getReportListAll(...params); }

    /**
     * TODO: Document requestAndDownloadReport
    */
    requestAndDownloadReport(...params) {
        const { requestAndDownloadReport: helper } = require(&apos;./helpers/reports&apos;);
        return helper(this)(...params);
    }

    static requestAndDownloadReport(...params) {
        return staticMws.requestAndDownloadReport(...params);
    }

    /**
     * TO DO: WRITE DOCUMENTATION
     */
    manageReportSchedule(...params) {
        const { manageReportSchedule: helper } = require(&apos;./helpers/reports&apos;);
        return helper(this)(...params);
    }

    static manageReportSchedule(...params) { return staticMws.manageReportSchedule(...params); }

    /**
     * TO DO: WRITE DOCUMENTATION
     */
    updateReportAcknowledgements(...params) {
        const { updateReportAcknowledgements: helper } = require(&apos;./helpers/reports&apos;);
        return helper(this)(...params);
    }

    static updateReportAcknowledgements(...params) {
        return staticMws.updateReportAcknowledgements(...params);
    }

    /**
     * TO DO: WRITE DOCUMENTATION
     */
    getReportScheduleList(...params) {
        const { getReportScheduleList: helper } = require(&apos;./helpers/reports&apos;);
        return helper(this)(...params);
    }

    static getReportScheduleList(...params) {
        return staticMws.getReportScheduleList(...params);
    }

    /* eslint-enable global-require */
}

MwsAdvanced.constants = constants;
module.exports = MwsAdvanced;
// module.exports.constants = constants;
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
